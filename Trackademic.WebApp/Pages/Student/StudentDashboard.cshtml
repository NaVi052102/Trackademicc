@page
@model Trackademic.WebApp.Pages.Student.StudentDashboardModel
@{
    ViewData["Title"] = "Dashboard";
}

@section Styles {
    <link rel="stylesheet" href="~/css/student-dashboard.css" asp-append-version="true" />
    <style>
        /* --- NEW STYLES FOR INITIALS & GRID --- */

        /* Grid Layout for Recent Classes */
        .class-grid-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        /* Card Styling */
        .class-card-dashboard {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            background-color: white;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

            .class-card-dashboard:hover {
                transform: translateY(-3px);
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            }

        /* Initials Box */
        .class-initials {
            width: 100%;
            height: 120px; /* Smaller height for dashboard cards */
            background: linear-gradient(135deg, #0d6efd, #0a58ca);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            letter-spacing: 1.5px;
        }

        .class-card-content {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .class-card-info {
            padding: 1rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

            .class-card-info h5 {
                font-weight: 600;
                margin-bottom: 0.5rem;
                color: #333;
                line-height: 1.3;
                font-size: 1rem;
            }

            .class-card-info p {
                margin: 0;
                color: #6c757d;
                font-size: 0.85rem;
            }
    </style>
}

<div class="dashboard-full-width-container">

    <div class="d-flex justify-content-between align-items-start mb-4">
        <div class="dashboard-title-wrapper">
            <h2>Welcome Back, @(Model.CurrentStudent?.FirstName ?? "Student")!</h2>
            <p class="text-muted">Quick overview of your academic status and enrolled courses.</p>
        </div>

    </div>

    @* --- 1. ACADEMIC SUMMARY CARDS --- *@
    <div class="row mb-5 d-flex dashboard-summary-container">

        <div class="col-md-3">
            <div class="dashboard-summary-card card-gpa card-small-size">
                <div class="dashboard-card-inner">
                    <i class="bi bi-star-fill display-5 mb-2"></i>
                    <div class="summary-card-title">Cumulative GPA/GWA</div>
                    <div class="dashboard-value-lg">@Model.CumulativeGPA.ToString("0.00")</div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="dashboard-summary-card card-units card-small-size">
                <div class="dashboard-card-inner">
                    <i class="bi bi-list-ol display-5 mb-2"></i>
                    <div class="summary-card-title">Total Units Earned</div>
                    <div class="dashboard-value-lg">@Model.TotalUnitsEarned</div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="dashboard-summary-card card-passed card-small-size">
                <div class="dashboard-card-inner">
                    <i class="bi bi-check-circle-fill display-5 mb-2"></i>
                    <div class="summary-card-title">Subjects Passed</div>
                    <div class="dashboard-value-lg">@Model.PassedSubjects / @Model.TotalSubjects</div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="dashboard-summary-card card-failed-status card-small-size">
                <div class="dashboard-card-inner">
                    <i class="bi bi-x-circle-fill display-5 mb-2"></i>
                    <div class="summary-card-title">Subjects Failed</div>
                    <div class="dashboard-value-lg">@Model.SubjectsFailed</div>
                </div>
            </div>
        </div>
    </div>

    @* --- 2. GPA HISTORY & CURRENT PERFORMANCE --- *@
    <div class="row mb-5 dashboard-main-content">

        @* 2a. GPA History Bar Graph *@
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm h-100 p-3">
                <h3 class="card-title mb-3"><i class="bi bi-graph-up me-2 text-primary"></i>GPA History</h3>
                <div class="card-body p-0 d-flex flex-column justify-content-end">
                    @if (Model.GpaHistory.Any())
                    {
                        <div class="gpa-bar-chart">
                            @foreach (var entry in Model.GpaHistory)
                            {
                                var barHeight = (int)((entry.Value / 5.0m) * 100);
                                var barColor = entry.Value <= 1.75m ? "gpa-bar-green" : (entry.Value <= 3.0m ? "gpa-bar-yellow" : "gpa-bar-red");

                                <div class="gpa-bar-wrapper" title="GPA @entry.Value.ToString("0.00")">
                                    <div class="gpa-bar @barColor" style="height: @(barHeight)%;">
                                        <span class="gpa-value">@entry.Value.ToString("0.00")</span>
                                    </div>
                                    <div class="gpa-label">@entry.Key</div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <p class="text-muted text-center py-5">No GPA history available.</p>
                    }
                </div>
            </div>
        </div>

        @* 2b. Recent Performance *@
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm h-100 p-3">
                <h3 class="card-title mb-3"><i class="bi bi-bullseye me-2 text-success"></i>Recent Performance</h3>
                <div class="card-body performance-list p-0">
                    @if (Model.PerformanceData.Any())
                    {
                        <ul class="list-unstyled">
                            @foreach (var perf in Model.PerformanceData)
                            {
                                string progressClass;
                                if (perf.Percentage >= 75) { progressClass = "bg-success"; }
                                else if (perf.Percentage >= 50) { progressClass = "bg-warning"; }
                                else { progressClass = "bg-danger"; }

                                <li class="performance-item">
                                    <div class="subject-info">
                                        <strong>@perf.SubjectCode</strong> - <span class="text-muted">@perf.Description</span>
                                    </div>
                                    <div class="progress-wrapper">
                                        <div class="progress performance-progress">
                                            <div class="progress-bar @progressClass" role="progressbar" style="width: @(perf.Percentage)%;"
                                                 aria-valuenow="@perf.Percentage" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        <span class="progress-text text-dark">@perf.CurrentGrade.ToString("0.00")</span>
                                    </div>
                                </li>
                            }
                        </ul>
                    }
                    else
                    {
                        <p class="text-muted text-center py-5">No grade data available yet.</p>
                    }
                </div>
            </div>
        </div>
    </div>

    @* --- 3. RECENT CLASSES --- *@
    <div class="mb-4">
        <h3 class="mb-3"><i class="bi bi-archive-fill me-2"></i> Recent Classes</h3>
    </div>

    <div class="class-grid-dashboard">
        @if (Model.EnrolledClasses.Any())
        {
            @foreach (var cls in Model.EnrolledClasses)
            {
                <div class="class-card-dashboard">
                    <div class="class-card-content">

                        <div class="class-initials">
                            @cls.Initials
                        </div>

                        <div class="class-card-info">
                            <h5>@cls.SubjectCode - @cls.Description</h5>
                            <p>@cls.Units Units &bull; @cls.FacultyName</p>
                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <p class="text-muted text-center py-4">No recent enrollments found.</p>
        }
    </div>

</div>

@section Scripts {
    <script>
        // Client-side search logic can be added here if desired
    </script>
}